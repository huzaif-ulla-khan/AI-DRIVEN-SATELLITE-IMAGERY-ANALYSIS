{% extends "layout.html" %}
{% block content %}
<div class="row g-4 align-items-stretch">
  <div class="col-12">
    <div class="p-4 rounded-4 hero">
      <h1 class="h3 fw-bold mb-1">AI-Driven Satellite Imagery Analysis</h1>
      <p class="text-secondary mb-0">Click on the map to pick a location, then analyze.</p>
    </div>
  </div>

  <div class="col-lg-8">
    <div id="map"></div>
  </div>

  <div class="col-lg-4">
    <form method="post" action="/analyze" class="p-4 rounded-4 bg-black border border-secondary h-100 d-flex flex-column">
      <div class="mb-3">
        <label class="form-label">Latitude</label>
        <input id="lat" name="lat" class="form-control bg-dark text-light" required />
      </div>
      <div class="mb-3">
        <label class="form-label">Longitude</label>
        <input id="lon" name="lon" class="form-control bg-dark text-light" required />
      </div>
      <div class="mb-3">
        <label class="form-label">Radius (km)</label>
        <input type="number" step="0.1" name="radius_km" value="5" class="form-control bg-dark text-light" />
      </div>
      <div class="mb-3">
        <label class="form-label">Start date (optional)</label>
        <input type="date" name="start_date" class="form-control bg-dark text-light" />
      </div>
      <div class="mb-4">
        <label class="form-label">End date (optional)</label>
        <input type="date" name="end_date" class="form-control bg-dark text-light" />
      </div>
      <button class="btn btn-primary btn-lg mt-auto" type="submit">Analyze</button>
      <div class="form-text text-secondary mt-2">Tip: click the map to auto-fill coordinates.</div>
    </form>
  </div>
</div>

<script>
  const map = L.map('map').setView([12.9716, 77.5946], 6); // Bengaluru default
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  let marker = null;
  map.on('click', (e) => {
    const { lat, lng } = e.latlng;
    document.getElementById('lat').value = lat.toFixed(6);
    document.getElementById('lon').value = lng.toFixed(6);
    if (marker) map.removeLayer(marker);
    marker = L.marker([lat, lng]).addTo(map).bindPopup(`Lat: ${lat.toFixed(4)}, Lon: ${lng.toFixed(4)}`).openPopup();
  });
</script>
{% endblock %}
